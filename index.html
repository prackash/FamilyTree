<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree Editor</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #tree-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            overflow: hidden;
        }
        #controls {
            margin: 20px 0;
        }
        button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Family Tree Editor</h1>
    <div id="controls">
        <input type="file" id="file-input" accept=".json">
        <button id="download-json">Download Updated JSON</button>
    </div>
    <div id="tree-container"></div>
    
    <script>
        let treeData = {};
        const width = 960, height = 600;

        // Create SVG canvas
        const svg = d3.select("#tree-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(50, 50)");

        const tree = d3.tree().size([width - 100, height - 100]);

        function updateTree(data) {
            const root = d3.hierarchy(data);
            tree(root);

            // Clear previous tree
            svg.selectAll("*").remove();

            // Create links
            const links = svg.selectAll(".link")
                .data(root.links())
                .enter()
                .append("line")
                .attr("class", "link")
                .style("stroke", "#aaa")
                .style("stroke-width", 2)
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            // Create nodes
            const nodes = svg.selectAll(".node")
                .data(root.descendants())
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            nodes.append("circle")
                .attr("r", 5)
                .style("fill", "#69b3a2");

            nodes.append("text")
                .attr("dy", ".35em")
                .attr("x", d => d.children ? -10 : 10)
                .style("text-anchor", d => d.children ? "end" : "start")
                .text(d => d.data.name);
        }

        document.getElementById("file-input").addEventListener("change", function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                treeData = JSON.parse(e.target.result);
                updateTree(treeData);
            };
            reader.readAsText(file);
        });

        document.getElementById("download-json").addEventListener("click", function() {
            const jsonBlob = new Blob([JSON.stringify(treeData, null, 2)], { type: "application/json" });
            const downloadLink = document.createElement("a");
            downloadLink.href = URL.createObjectURL(jsonBlob);
            downloadLink.download = "updated_tree.json";
            downloadLink.click();
        });
    </script>
</body>
</html>
